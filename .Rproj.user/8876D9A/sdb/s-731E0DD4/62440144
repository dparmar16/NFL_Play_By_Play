{
    "contents" : "head(nfldata)\n#Load NFL data (already done in previous script)\n#Take a look at \n\ntable(nfldata[nfldata$dwn==3,]$yfog,nfldata[nfldata$dwn==3,]$ytg)\ntable(nfldata[nfldata$dwn==3,]$ytg)\n\nlibrary(sqldf)\n\n#Step 1: get third down data\nnfl3 <- nfldata[nfldata$dwn==3,]\nnfl3 <- nfl3[nfl3$type==\"PASS\"| nfl3$type == \"RUSH\",]\nnfl3[1:20,]\nattach(nfl3)\n\n#Step 2: create buckets with ifthenelse (1-3 short 4-6 medium 7-10 long 11+ distant)\nx = 1\ndistance = c()\n# distance[x] <- for (x in 1:nrow(nfl3)) {\n#   if (ytg[x] >= 0 & ytg[x] <= 3) \"Short\"\n#   else if (ytg[x] >= 4 & ytg[x] <= 6) \"Medium\"\n#   else if (ytg[x] >= 7 & ytg[x] <= 10) \"Long\"\n#   else if (ytg[x] >= 11) \"Distant\"}\nfor (x in 1:nrow(nfl3)) {\n  if (ytg[x] >= 0 & ytg[x] <= 3) distance[x] <- \"Short\"\n  else if (ytg[x] >= 4 & ytg[x] <= 6) distance[x] <-\"Medium\"\n  else if (ytg[x] >= 7 & ytg[x] <= 10) distance[x] <-\"Long\"\n  else if (ytg[x] >= 11) distance[x] <- \"Distant\"}\nnfldis <- cbind(nfl3,distance)\nhead(nfldis)\n\n\n#Step 3: get percentage conversion then test for stat sig with two sample binomial \nlibrary(plyr)\nconv_rate <- ddply(nfldis, .(distance, type),summarise, conversionrate = sum(fd)/length(pid), numberattempts = length(pid),converts = sum(fd),fails=length(fd[fd==0]))\nconv_rate$se <- sqrt((conv_rate$conversionrate)*(1-conv_rate$conversionrate)/(conv_rate$numberattempts))\nconv_rate\nlibrary(ggplot2)\nqplot(conv_rate[,4],conv_rate[,3],xlab=\"Number of attempts\",ylab=\"Conversion Rate\",xlim=c(0,1000)) + geom_text(aes(label=paste(conv_rate[,1],conv_rate[,2]),parse=TRUE),cex=3)\n\n\nqplot(conv_rate[,4],conv_rate[,3],xlab=\"Number of Attempts\",ylab=\"Conversion Rate (as Decimal)\", ylim=c(0,.8),\n      main=\"Conversion Rate vs. Number of Attempts \\n by Play Type and Yards to Go \\n with 95 Percent Confidence Bands\",\n      xlim=c(0,1000)) + geom_text(aes(label=paste(conv_rate[,1],conv_rate[,2]),parse=TRUE),\n                                  cex=3) + geom_errorbar(ymin=conv_rate[,3]-1.96*conv_rate[,7],\n                                                          ymax=conv_rate[,3]+1.96*conv_rate[,7])#,colour=type)\n\n#ggplot(cuts, aes(cut, fit,\n#                 ymin = fit - se.fit, ymax=fit + se.fit, colour = cut))\n\n#stat sig\n#Distant\nprop.test(conv_rate$converts[1:2],conv_rate$numberattempts[1:2],alternative=\"greater\")\n#Long\nprop.test(conv_rate$converts[3:4],conv_rate$numberattempts[3:4],alternative=\"two.sided\")\n#Medium\nprop.test(conv_rate$converts[5:6],conv_rate$numberattempts[5:6],alternative=\"two.sided\")\n#Short\nprop.test(conv_rate$converts[7:8],conv_rate$numberattempts[7:8],alternative=\"less\")\n\n#curve by ytg\nconv_yards <- ddply(nfldis[ytg < 16,], .(ytg, type),summarise, conversionrate = sum(fd)/length(pid), numberattempts = length(pid),converts = sum(fd),fails=length(fd[fd==0]))\nconv_yards\n\nqplot(data=conv_yards, x=ytg, y=conversionrate, color=type,\n      xlab=\"Yards to Get First Down\",ylab=\"Conversion Rate\",\n      main=\"Conversion Rate by Play Type and Yards-to-Go \\n with 95 Percent Confidence Interval\") + geom_line() + stat_smooth(level=0.95,aes(fill=type))\n\n#All data points added then smoother; not much better or different result\n#qplot(data=nfldis[ytg<16,], x=ytg, y=fd, color=type) + geom_line() + stat_smooth(level=0.95,aes(fill=type))\n\n\n#Step 4: create buckets of 5 yard intervals\nconv_loc <- ddply(nfldis[ytg < 11,], .(yfog, ytg,distance),summarise, conversionrate = sum(fd)/length(pid), numberattempts = length(pid),converts = sum(fd),fails=length(fd[fd==0]))\nconv_loc\n\nconv_loc$zone <- cut(conv_loc$yfog, seq(0,100,by=10),labels=seq(0,90,by=10))\n\nconv_range <- ddply(conv_loc,.(zone,distance), summarise, convrate = sum(converts)/sum(numberattempts),attempts=sum(numberattempts))\nconv_range$stan_error = sqrt((conv_range$convrate)*(1-conv_range$convrate)/(conv_range$attempts))\n\nconv_range\n\nlimits = aes(min=conv_range[,3]-1.96*conv_range[,5], max=conv_range[,3]+1.96*conv_range[,5])\n\nqplot(data=conv_range,x=zone,y=convrate,xlab=\"Yardline of Field\",ylab=\"Third Down Conversion Rate\",\n      main=\"Third Down Conversion Rate by Field Location\",ylim=c(0.2,0.8),aes(colour=distance,x=zone,y=convrate)) + \n  geom_point(aes(colour=distance)) +\n  geom_line(aes(x=conv_range$zone, y=conv_range$convrate,group=conv_range$distance,colour=conv_range$distance)) + \n  geom_errorbar(limits,color=rep(c(\"red\",\"dark green\",\"blue\"),10)) #width=0.2,\n\n#aes(x=conv_range[,1]), y=conv_range[,3],colour=conv_range[,2]),\n                #ymin=conv_range[,3]-1.96*conv_range[,5], ymax=conv_range[,3]+1.96*conv_range[,5])\n\n#geom_bar(aes(x=conv_range$zone,y=conv_range$convrate,colour=conv_range$distance),stat=\"identity\") +\n#conv_range <- sqldf(\"select zone, distance, case(zone=10,sum(converts)/sum(fails),0) from conv_loc group by zone, distance\")\n\nlibrary(ggplot2)\n#qplot(data=conv_loc, x=yfog, y=conversionrate) + geom_line() + stat_smooth(level=0.95, colour=\"red\",fill=\"blue\")# + geom_hline(yintercept=0.5, color=\"red\")+ geom_hline(yintercept=0.45, color=\"red\")+ geom_hline(yintercept=0.4, color=\"red\")\n#ADD TITLES TO PLOT\n#NORMALIZE to 50 percent and group to reduce noise\n\n\n#,aes(fill=type))#, color=distance) + geom_line() #+ stat_smooth(level=0.1,aes(fill=type))\n#abline(h=.5)\n\n#by yardline on field (see if location of play matters)\n#see if play number on drive matters - aka more mature drive\n\n#Step 5: get conversion rate by yard bucket then test for stat sig\n\n#Step 1: get 4th down data\n#Step 2: create buckets with ifthenelse (1-3 short 4-6 medium 7-10 long 11+ distant)\n#Step 3: get percentage conversion then test for stat sig with two sample binomial test\n\n#Step 1: get red zone data\n#Step 2: look at which plays reach end zone \n#Step 3: get conversion rate by play type and yardline\n\n#THIRD DOWN PERCENTAGES by run or pass (recommendation to teams...test statistical significance)\n#FOURTH DOWN PERCENTAGES\n#MOST EFFICIENT PLAYS IN THE RED ZONE that get TDs\n\n",
    "created" : 1449969452167.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1083015820",
    "id" : "62440144",
    "lastKnownWriteTime" : 1450781643,
    "path" : "~/R/NFL_Play_By_Play/Play Efficiency.R",
    "project_path" : "Play Efficiency.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}